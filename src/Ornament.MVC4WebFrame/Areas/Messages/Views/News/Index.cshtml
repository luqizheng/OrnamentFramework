@using Ornament.Messages.Newses
@using Ornament.Web
@using Resources
@model IEnumerable<Ornament.Messages.Newses.News>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_appLayout.cshtml";
    var types = (IList<NewsType>)ViewData["types"];
    var selectedType = ViewData["type"] as NewsType;
    var pae = ViewData["nav"] as Pagination;
}
@section pageTitle
{
    <h5>News list</h5>
}
<div class="actions-wrapper">
    <div class="actions">

        <div id="user-stats">
            <ul class="round-buttons">
                <li>
                    <div class="depth"><a href="@Url.Action("Create")" title="Add News" class="tip"><i class="icon-plus-sign"></i></a></div>
                </li>
                <li>
                    <div class="depth"><a href="" title="Media posts" class="tip"><i class="icon-reorder"></i></a></div>
                </li>
            </ul>
        </div>
        <ul class="action-tabs">
            <li><a href="#user-stats" title="">@Html.GetResourceString("QuickActions")</a></li>
        </ul>
    </div>
</div>

<div class="widget">
    <ul class="options-bar">
        <li>
            <div class="bar-select pull-left">
                <span>News Type: </span>
                <select name="Type" id="Type">
                    @foreach (NewsType type in types ?? (new List<NewsType>()))
                    {
                        if (selectedType == type)
                        {
                            <option value="@type.Id" selected="selected">@type.Name</option>
                        }
                        else
                        {
                            <option value="@type.Id" >@type.Name</option>
                        }
                    }
                </select>

            </div>
            <div class="bar-button">
                <button type="button" class="btn btn-info">Apply</button>
            </div>
        </li>
        <li class="bar-entries">
            <span>Showing @pae.ShowsNumberStart - @pae.ShowNumberEnd of @pae.TotalNumber entries &nbsp;&nbsp; </span>
        </li>
        @* <li>
            <div class="pull-right bulk">
                <div class="bar-select">
                    <span>Bulk actions: </span>
                    <select name="select2" class="styled">
                        <option value="opt1">Edit</option>
                        <option value="opt2">Unpublish</option>
                        <option value="opt3">Publish</option>
                        <option value="opt4">Move to trash</option>
                    </select>
                </div>

                <div class="bar-button">
                    <button type="button" class="btn btn-info">Apply</button>
                </div>
            </div>
        </li>*@
    </ul>
</div>

<div class="widget">

    @if (Model.Count() != 0)
    {
        <div class="table-overflow">

            <table class="table table-condensed table-striped table-bordered">
                <tr>
                    <th>Subject
                    </th>
                    <th>Type 
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.State)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.CreateTime)
                    </th>
                    <th></th>
                </tr>
                @foreach (News item in Model)
                {
                    <tr>
                        <td>
                            @if (item.Contents.Count != 0)
                            {
                                @Html.DisplayFor(modelItem => item.Show().Subject)
                            }
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Type.Name)
                        </td>
                        <td>
                            @Html.DisplayFor(modeItem => item.State)
                        </td>
                        <td>
                            @Html.DisplayFor(modelItem => item.CreateTime)
                        </td>
                        <td>
                            @Html.ActionLink(Basic.Edit, "Edit", new { id = item.Id }, new { @class = "btn" })
                            <a data-toggle="popover" data-val="@item.Id" class="btn btn-danger" href="#">@Basic.Delete</a>
                        </td>
                    </tr>
                }
                <tfoot></tfoot>
            </table>
        </div>
    }
    else
    {
        <div class="alert">
            <h6>No news found. 
            </h6>
        </div>
    }


    @if (Model.Count() != 0)
    {
        <div class="table-footer">
            <form method="POST">
                @Html.Partial("NavPagination", ViewData["nav"])
            </form>
        </div>
    }
</div>
<div id="warning" class="hide">
    <p>Do you want to delete this news ?</p>
    <button class="btn   btn-danger  deleteYes">@Basic.Delete</button>
    <button class="btn deleteNo">@Basic.Cancel</button>

</div>

@section script
{
    <script type="text/javascript">
        seajs.use(["bootstrap", "select2"], function () {
            var $popver = $("[data-toggle=popover]").popover({ html: true, content: $("#warning").html(), placement: "top", title: "Warning" });
            $("#Type").select2();
            $(document)
                .delegate("button.deleteYes", "click", function () {
                    $("[data-toggle=popover]").popover("hide");
                    $td = $(this).closest("td");
                    var id = $td.find("a:eq(1)").attr("data-val");
                    $.get("@Url.Action("Delete")/" + id, function (data) {
                        if (data.success) {
                            $td.closest("tr").remove();
                        } else {
                            alert(data.message);
                        }
                    });
                    $popver.popover("hide");
                })
                .delegate("button.deleteNo", "click", function () {
                    $popver.popover("hide");
                });
        });
    </script>
}