@using MvcSiteMapProvider
@using Ornament.Web
@using Ornament.Web.MemberShips
@{

    //var nodeList = SiteMap.RootNode.ChildNodes[0].ChildNodes;
    var site = new SiteMapPermission(OrnamentContext.Current, Ornament.Context.OperatorResourceManager);
}
@helper RenderMenu(SiteMapNodeCollection nodeCollection, int level, int maxLevel)
{
    if (nodeCollection == null)
    {
        return;
    }
    for (int i = 0; i < nodeCollection.Count; i++)
    {
        var node = (MvcSiteMapNode)nodeCollection[i];
        var clz = node.Equals(Html.MvcSiteMap().Provider.CurrentNode) ? "class=active" : "";
        
    <li @clz>
        @RenderHref(node, true, level == 0)

        @if (node.HasChildNodes && (level + 1) < maxLevel)
        {
            <ul>
                @RenderMenu(node.ChildNodes, level + 1, maxLevel)
            </ul>
        }
    </li>
    }
}
<ul class="navigation widget">
    @*Html.GetChildMenus(site)*@
    @RenderMenu(SiteMap.RootNode.ChildNodes, 0, 10)
</ul>

@helper RenderHref(MvcSiteMapNode node, bool defaultStyle, bool firstLevel)
{

    var href = node.Clickable ? node.Url : "#";
    var hasChild = firstLevel && node.HasChildNodes;
    var extendClass = hasChild ? "class='expand'" : "";
    <a href="@href" @Html.Raw(extendClass)>
        @if (!String.IsNullOrEmpty(node.ImageUrl))
        {
            <i class="@node.ImageUrl"></i>
        }
        else if (defaultStyle)
        {
            <i></i>
        }
        @node.Title
        @if (firstLevel && node.HasChildNodes)
        {
            <strong>@node.ChildNodes.Count</strong>
        }
    </a>
}