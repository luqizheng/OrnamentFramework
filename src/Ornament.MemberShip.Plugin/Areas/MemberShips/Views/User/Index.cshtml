@using Ornament
@using Ornament.MemberShip
@using Ornament.MemberShip.Plugin.Areas.MemberShips.Models
@using Ornament.MemberShip.Plugin.Models
@using Ornament.MemberShip.Plugin.Models.Memberships
@using Ornament.Web
@using Ornament.Web.UI.Theme
@using Ornament.Web.UI.Paginations;
@using SeajsBundles
@model IEnumerable<User>
@{
    ViewBag.Title = Html.GetEmbededResourceString("page_title");
    Layout = OrnamentContext.Configuration.BackendLayout();
    bool editPermission = OrnamentContext.MemberShip.HasRight(ResourceSetting.User, UserOperator.Modify);
    var status = ViewData["UserStatus"] as UsersStatusModel;
}


@section scripts 
{
    @* @Html.Partial("_pm")*@

    <script type="text/javascript">

        var multiLanguate = {

            verifyEmailMessage: {
                success: '@Html.GetEmbededResourceString("verify_email_success")',
                fail: '@Html.GetEmbededResourceString("verify_email_fail")'
            },
            retrievePwdMessage: {
                success: '@Html.GetEmbededResourceString("retrieve_pwd_success")',
                fail: '@Html.GetEmbededResourceString("retrieve_pwd_fail")'
            }
        };

        var curUser = {
            Id: "@OrnamentContext.MemberShip.CurrentUser().Id",
            Name: "@OrnamentContext.MemberShip.CurrentUser().Name"
        };

        seajs.use('@ScriptsSeajs.RenderUrl("~/MemberShips/Scripts/User/Index.js")', function (main) {
            main.init(multiLanguate);
        });
    </script>
}

@section pageTitle{
    <h3>@Html.GetEmbededResourceString("page_title")</h3>
}
@using (var box = Html.Panel())
{
    @box.Header(@<text>

    <a href="@Url.Action("Create")" class="btn btn-primary">@Ornament.Properties.Resources.Add</a>

    </text>)
    
    @box.Body(
        @<text>
    <div ms-controller="index">
        <table class="table table-condensed table-striped table-bordered table-checks">
            <thead>
                <tr>
                    <th style="width: 180px;"></th>
                    <th>
                        @Html.DisplayNameFor(model => model.LoginId)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Name)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Contact.Email)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.IsLockout)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.IsApproved)
                    </th>
                    <th>
                        @Html.DisplayNameFor(model => model.Other.LastActivityDate)
                    </th>
                </tr>
            </thead>
            <tbody ms-each-el="users">
                <tr ms-attr-data="{{el.Id}}" ms-attr-loginid="{{el.LoginId}}">
                    <td>
                        <a ms-href="/MemberShips/User/Edit/{{el.LoginId}}" class="btn tip btn-mini"><i class="fam-user-edit"></i></a>
                        <a ms-href="/MemberShips/User/Assign/{{el.LoginId}}" class="btn tip btn-mini" title=""><i class="fam-group-gear"></i></a>
                        <a ms-href="#{{el.Email}}" class="btn tip btn-mini" title="" ms-click="verifyEmail" ms-if="el.Email!=''"><i class="fam-email-go"></i></a>
                        <a ms-href="#{{el.Email}}" class="btn tip btn-mini" title="Retrieve Password" ms-if="el.Email!=''" ms-click="retievePwd"><i class="fam-key-go"></i></a>
                    </td>
                    <td ms-text="el.LoginId"></td>
                    <td ms-text="el.Name"></td>
                    <td ms-text="el.Email"></td>
                    <td>
                        <div class="btn-group">
                            <a class="btn btn-primary btn-mini" ms-click="swtchLock">
                                <i ms-class="icon-lock:el.IsLockout" ms-class-1="icon-unlock:!el.IsLockout"></i>
                            </a>
                            <a class="btn btn-primary btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="icon-caret-down icon-white"></i>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="#" ms-click="lock"><i class="icon-lock"></i>@Html.GetEmbededResourceString("Lock")</a></li>
                                <li><a href="#" ms-click="unlock"><i class="icon-unlock"></i>@Html.GetEmbededResourceString("Unlock")</a></li>
                            </ul>
                        </div>
                    </td>
                    <td>
                        <div class="btn-group">
                            <a class="btn btn-primary btn-mini" ms-click="switchApprove">
                                <i ms-class="icon-ok:el.IsApproved" ms-class-1="icon-remove:!el.IsApproved"></i>
                            </a>
                            <a class="btn btn-primary btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                                <i class="icon-caret-down icon-white"></i>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="#" ms-click="approve"><i class="icon-ok"></i>@Html.GetEmbededResourceString("Approve")</a></li>
                                <li><a href="#" ms-click="verify"><i class="icon-remove"></i>@Html.GetEmbededResourceString("VerifyAgain")</a></li>
                            </ul>
                        </div>
                    </td>
                    <td ms-text="LastActivityDate"></td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="7">
                        @Html.Pages()
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
    </text>
)
}