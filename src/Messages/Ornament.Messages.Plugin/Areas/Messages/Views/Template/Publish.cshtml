@using FluentNHibernate.Conventions.Helpers
@using Microsoft.Ajax.Utilities
@using Ornament
@using Ornament.Messages.Notification
@using Ornament.Web.UI.Theme
@using Qi.Web
@using System.Collections.Generic;
@model Ornament.Messages.Plugin.Areas.Messages.Models.PublisherTemplate


@{
    ViewBag.Title = "Publisher notify template";
    Layout = OrnamentContext.Configuration.Layout();
    var template = (NotifyMessageTemplate)ViewData["temp"];

    var tableList = new System.Collections.Generic.Dictionary<string, string[]>();
    //第一个key是variabl，value是变量名字，如果为null，就是这个语言下面并不包括这个变量。
    var languageIndex = 0;
    foreach (var language in this.Model.Variables.Keys)
    {
        foreach (var varName in this.Model.Variables[language].Keys)
        {
            if (!tableList.ContainsKey(varName))
            {
                tableList.Add(varName, new string[this.Model.Variables.Count]);
            }
            tableList[varName][languageIndex] = varName;
        }
        languageIndex++;
    }
}
<form method="POST" action="@Url.Action("Publish")" id="templateForms"  ms-controller="example">
    @Html.HiddenFor(s => s.Id)
    @using (var panel = Html.Panel("col-md-6"))
    {
        @panel.Header(@<text>
        <h2>Variable Setting(Demo only)</h2>
        </text>)

        @panel.Body(@<text>
        @{
            var languages = this.Model.Variables.Keys.ToArray();
           
        }
        <table class="table table-condensed table-bordered">
            <thead>
                <tr>
                    <td></td>
                    @foreach (var language in languages)
                    {
                        <td>@language</td>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var varName in tableList.Keys)
                {
                 
                        languageIndex = 0;
                    
                     <tr>
                    <td>
                        @varName
                    </td>
                    @foreach (var setting in tableList[varName])
                    {
                   
                        <td>
                            @if (setting != null)
                            {
                                <input name="Variables[@languages[languageIndex]][@varName]" value="" class="form-control"/>
                            }
                        </td>
                        languageIndex++;
                    }
                </tr>
                }
            </tbody>

        </table>
        </text>)



        <div class="form-actions">
            <button type="submit" class="btn btn-danger">Publish</button>
            <button type="button" ms-click="getDemo" class="btn btn-primary">Demo</button>
        </div>
    }


@using (var panel = Html.Panel("col-md-6"))
{
    @panel.Header(@<text>
    <h2>Example</h2>
    </text>)

    @panel.Body(@<text>



    <div ms-repeat="Contents" ms-attr-id="c{{el.Language}}" class="tab-pane well" ms-class-active="$index==0">
        <h4 ms-text="el.Language"></h4>
        <dl>
            <dt ms-text="el.Subject "></dt>
            <dd ms-text="el.Value"></dd>
        </dl>
    </div>


    </text>)

}
    </form>

@section scripts{
    <script type="text/javascript">
        require(['@Scripts.Url("/Messages/Scripts/Template/Publish.js")'], function (main) {
            var contents=@Html.Raw(JsonHelper.ToJson(template.Contents.Values));
            main.init(contents);
            clearPageVariable.push(main.clear);
        })
    </script>
}